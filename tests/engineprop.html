<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=900">
	<title>engine properties</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<!--<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>-->
	<!-- custom -->
	<style>
		table {width: 880px;}
		#tb3 td:first-child { text-align: left; vertical-align: top;}
		hr {color: #dcc18c}
	</style>
</head>
<body>

	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb3">
		<col width="50%"><col width="50%">
		<thead><tr><th colspan="2">
			<div class="nav-title">engine properties
				<div class="nav-up"><span class="c perf" id="perf"></span></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="mono" style="text-align: left; vertical-align: top;">
			<span class="btn3 btnfirst" onClick="rerun()">[ run ]</span>
			<span class="btn3 btn" onClick="logConsole(`list`)">[ log list ]</span>
			<span class="btn3 btn" onClick="scrape()">[ scrape ]</span>
			<span class="btn3 btn" onClick="copyclip(`results`)">[ copy ]</span>
			<br><br>
			<hr>
			<br>
			<span class="spaces" style="color: #b3b3b3;" id="results"></span>
			</td>
		</tr>
	</table>
	<br>

<script>
'use strict';

let oTypes = {},
	aList = [],
	aNew = [], // level 1 items found in scrape not in the test
	aErr = [], // invalid group codes
	tstart,
	padNum = 14,
	domresult = document.getElementById("results"),
	domperf = document.getElementById("perf"),
	s3 = "<span class='s3'>",
	s9 = "<span class='s9'>",
	s12 = "<span class='s12'>",
	s14 = "<span class='s14'>",
	s17 = "<span class='s17'>",
	sb = "<span class='bad'>",
	sg = "<span class='good'>",
	sc = "</span>",
	green_tick = "<span style='font-size: 10px;'><b>" + s9 +" \u2713"+ sc + "</b></span>",
	red_cross = "<span style='font-size: 10px;'><b>" + sb +" \u2715"+ sc + "</b></span>"

/** functions from generic **/
// we don't want to include globals or generic which will pollute scraping

function mini(str) {
	// https://stackoverflow.com/a/22429679
	const json = `${JSON.stringify(str)}`
	let i, len, hash = 0x811c9dc5
	for (i = 0, len = json.length; i < len; i++) {
		hash = Math.imul(31, hash) + json.charCodeAt(i) | 0
	}
	return ('0000000' + (hash >>> 0).toString(16)).slice(-8)
}

function mini_sha1(str) {
	return sha1(mini(str))
}

function sha1(str1){
	for (var blockstart=0,
		i = 0,
		W = [],
		H = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0],
		A, B, C, D, F, G,
		word_array = [],
		temp2,
		s = unescape(encodeURI(str1)),
		str_len = s.length;
		i<=str_len;){
		word_array[i>>2] |= (s.charCodeAt(i)||128)<<(8*(3-i++%4));
	}
	word_array[temp2 = ((str_len+8)>>6<<4)+15] = str_len<<3;
	for (; blockstart <= temp2; blockstart += 16) {
		A = H,i=0;
		for (; i < 80;
			A = [[
				(G = ((s=A[0])<<5|s>>>27) + A[4] + (W[i] = (i<16) ? ~~word_array[blockstart + i] : G<<1|G>>>31) + 1518500249) + ((B=A[1]) & (C=A[2]) | ~B & (D=A[3])),
				F = G + (B ^ C ^ D) + 341275144,
				G + (B & C | B & D | C & D) + 882459459,
				F + 1535694389
			][0|i++/20] | 0, s, B<<30|B>>>2, C, D]
		) {
			G = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];
		}
		for(i=5;i;) H[--i] = H[i] + A[i] | 0;
	}
	for(str1='';i<40;)str1 += (H[i>>3] >> (7-i++%8)*4 & 15).toString(16);
	return str1
}

function copyclip(element) {
	// fallback: e.g FF62-
	function copyExec() {
		if (document.selection) {
			let range = document.body.createTextRange()
			range.moveToElementText(document.getElementById(element))
			range.select().createTextRange()
			document.execCommand("copy")
		} else if (window.getSelection) {
			let range = document.createRange()
			range.selectNode(document.getElementById(element))
			window.getSelection().addRange(range)
			document.execCommand("copy")
		}
	}
	// clipboard API
	if ("clipboard" in navigator) {
		try {
			let content = document.getElementById(element).innerHTML
			// remove spans, change linebreaks
			let regex = /<br\s*[\/]?>/gi
			content = content.replace(regex, "\r\n")
			content = content.replace(/<\/?span[^>]*>/g,"")
			content = content.replace(/<\/?hr[^>]*>/g,"")
			// get it
			navigator.clipboard.writeText(content).then(function() {
				// clipboard successfully set
			}, function() {
				// clipboard write failed
				copyExec()
			})
		} catch(e) {
			copyExec()
		}
	} else {
		copyExec()
	}
}

/** function for this test **/

function collectProps () {
	const objCache = new Set();
	// skip these
	objCache.add(window.self);
	// prevent us decending into the DOM
	objCache.add(document);
	objCache.add(document.activeElement);
	//objCache.add(event?.currentTarget); // FF73 or lower this causes a syntax error
	if (self.event && event.currentTarget) objCache.add(event.currentTarget)

	const recursionAllowed = new Set();
	recursionAllowed.add('navigator');
	function extractObjectProps (obj, breadcrumbs = [], depth = 0) {
		if (depth >= 5) {
			return {};
		}
		const props = {};
		const proplist = [];
		for (const prop in obj) {
			proplist.push(prop);
		}
		proplist.sort().forEach((prop) => {
			try {
				const desc = Object.getOwnPropertyDescriptor(obj, prop) || {};
				desc.type = typeof obj[prop];
				if (desc.type === 'function') {
					desc.value = obj[prop].toString();
				} else if (desc.type === 'object') {
					if (!objCache.has(obj[prop]) || recursionAllowed.has(prop)) {
						objCache.add(obj[prop]);
						desc.properties = extractObjectProps(obj[prop], [...breadcrumbs, prop], depth + 1);
					}
						delete desc.value;
					}
					props[prop] = desc;
			} catch (e) {
				console.warn(`Error for ${breadcrumbs.join('.')}.${prop}`, e);
			}
		});
		return props;
	}
	return {
		window: extractObjectProps(window)
	}
}

function logConsole(name) {
	let array = [], str = ""
	if (name == "list") { array = aList; str = "TEST LIST"
	}
	console.log(str +" [" + array.length +"]\n" + array.join("\n"))
}

function output() {
	domperf.innerHTML = Math.round((performance.now() - tstart)) +" ms | "+ aList.length +" items"
	aList.sort()
	let aDupe = aList
	aList = aList.filter(function(item, position) {return aList.indexOf(item) === position})
	let hDupe = mini(aDupe.join())
	let hList = mini(aList.join())
	let strDupe = ""
	if (hList !== hDupe) {
		aDupe = aDupe.filter((item, index) => aDupe.indexOf(item) !== index)
		strDupe = sb + "DUPLICATES" + sc
			+ "<br><br>" + aDupe.join(", ") + "<br><br><hr><br>"
	}

	let display = []
	for (const k of Object.keys(oTypes).sort()) {
		let group = oTypes[k]
		let gHash = []
		let gDisplay = []
		let gCount = 0
		let gCountUndefined = 0
		// get group details
		for (const n of Object.keys(group).sort()) {
			let data = group[n]
			data.sort()
			gCount += data.length
			if (data.length) {
				let tHash = mini_sha1(data.join())
				gHash.push(n +": "+ tHash)
				gDisplay.push(s3 + n.padStart(padNum) + sc +": "+ tHash + s3 +" ["+ data.length +"]"+ sc +"<br>")
				gDisplay.push("'"+ data.join("', '") + "'<br>")
				if (n == "undefined") {
					gCountUndefined += data.length
				}
			}
		}
		// get group hash
		let hashG = gHash.length ? mini_sha1(gHash.join()) +" ["+ gCount +"]" : ""
		// add group header
		let strG = "", strExtra = "", strColor = s12
			//only
		if (k == 10) {strG = "BLINK ONLY"
		} else if (k == 12) { strG = "GECKO ONLY"
		} else if (k == 14) { strG = "WEBKIT ONLY"
			// in two but not the other
		} else if (k == 50) { strG = "BLINK + GECKO"; strColor = s14; strExtra = " [not webkit... yet]"
		} else if (k == 52) { strG = "BLINK + WEBKIT"; strColor = s14; strExtra = " [not gecko... yet]"
		} else if (k == 54) { strG = "GECKO + WEBKIT"; strColor = s14; strExtra = " [not blink... yet]"
			// the rest
		} else if (k == 98) { strG = "UNDETERMINED"; strColor = s17; strExtra = " to be assessed"
		} else if (k == 99) { strG = "IGNORE"; strColor = s17; strExtra = " confirmed in all three engines"
		}
		strG = strG.padStart(padNum)
		let header = strG + (gHash.length ? ": "+ hashG : "")
		// add a green "all undefined" - we should get at least three per engine
		let strU = ""
		if (gHash.length && k < 90) {
			if (gCount == gCountUndefined) {
				strU = " "+ green_tick + sg +" all "+ gCountUndefined +" undefined"+ sc
			}
		}
		display.push(strColor + header + strExtra + sc + strU +"<br>")
		// add group detail
		if (gHash.length) {
			display.push(gDisplay.join("<br>"))
		}
		// hr
		if (k < 99) {
			display.push("<br><hr>")
		}
	}
	// invalid group codes
	let strErr = ""
	if (aErr.length) {
		strErr = sb + "INVALID GROUP CODES" + sc
			+ "<br><br>" + aErr.join(", ") + "<br><br><hr><br>"
	}
	// function hash
	let strF = ""
	try {
		let testF = atob.toString()
		testF = testF.replace(/\n/g,'\\n');
		let hashF = mini(testF)
		strF = s14 + ("FUNCTION").padStart(padNum) + sc +": "+ hashF + " : " + testF + "<br><br><hr><br>"

	} catch(e) {
		console.error(e.name, e.message)
	}
	// output
	domresult.innerHTML = strErr + strDupe + strF + display.join("<br>")
}

function rec(type, name, group = 98) {
	aList.push(name)
	try {
		oTypes[group][type].push(name)
	} catch(e) {
		aErr.push(name)
		oTypes[98][type].push(name)
	}
}

function reset() {
	aList = []
	aErr = []
	domresult.innerHTML = ""
	oTypes = {}
	let groups = [10,12,14,50,52,54,98,99]
	let types = ["bigint","boolean","function","number","object","string","symbol","undefined",]
	groups.forEach(function(group) {
		oTypes[group] = {}
		types.forEach(function(type) {
			oTypes[group][type] = []
		})
	})
}

function rerun() {
	reset()
	// delay so user sees changes
	setTimeout(function() {
		run()
	}, 170)
}

function run() {
	try {
		tstart = performance.now()
		let code

/** LEVEL ONE ***/

// undetermined: status confirmed in EOL comments (A = android)
	// where the F did I get these two from?
code = 98
rec(typeof event, "event", code)
rec(typeof keys, "keys", code)

// blink only
code = 10
rec(typeof Keyboard, "Keyboard", code)
rec(typeof KeyboardLayoutMap, "KeyboardLayoutMap", code)
rec(typeof PERSISTENT, "PERSISTENT", code)
rec(typeof TEMPORARY, "TEMPORARY", code)
rec(typeof chrome, "chrome", code)
rec(typeof cookieStore, "cookieStore", code)
rec(typeof getDigitalGoodsService, "getDigitalGoodsService", code) // android
rec(typeof getScreenDetails, "getScreenDetails", code)
rec(typeof launchQueue, "launchQueue", code)
rec(typeof navigation, "navigation", code)
rec(typeof offscreenBuffering, "offscreenBuffering", code)
rec(typeof onappinstalled, "onappinstalled", code)
rec(typeof onbeforeinstallprompt, "onbeforeinstallprompt", code)
rec(typeof onbeforematch, "onbeforematch", code)
rec(typeof onbeforexrselect, "onbeforexrselect", code)
rec(typeof oncontextlost, "oncontextlost", code)
rec(typeof oncontextrestored, "oncontextrestored", code)
rec(typeof ondeviceorientationabsolute, "ondeviceorientationabsolute", code)
rec(typeof onpointerrawupdate, "onpointerrawupdate", code)
rec(typeof onsearch, "onsearch", code)
rec(typeof openDatabase, "openDatabase", code)
rec(typeof opr, "opr", code) // OPERA desktop at least
rec(typeof originAgentCluster, "originAgentCluster", code)
rec(typeof queryLocalFonts, "queryLocalFonts", code)
rec(typeof showDirectoryPicker, "showDirectoryPicker", code)
rec(typeof showOpenFilePicker, "showOpenFilePicker", code)
rec(typeof showSaveFilePicker, "showSaveFilePicker", code)
rec(typeof trustedTypes, "trustedTypes", code)
rec(typeof webkitRequestFileSystem, "webkitRequestFileSystem", code)
rec(typeof webkitResolveLocalFileSystemURL, "webkitResolveLocalFileSystemURL", code)
rec(typeof webkitStorageInfo, "webkitStorageInfo", code)

// gecko only
code = 12
rec(typeof InstallTrigger, "InstallTrigger", code) // prefs-to-be-deprecated
rec(typeof KeyEvent, "KeyEvent", code)
rec(typeof content, "content", code) // deprecated
rec(typeof dump, "dump", code)
rec(typeof fullScreen, "fullScreen", code)
rec(typeof getDefaultComputedStyle, "getDefaultComputedStyle", code)
rec(typeof mozInnerScreenX, "mozInnerScreenX", code)
rec(typeof mozInnerScreenY, "mozInnerScreenY", code)
rec(typeof mozPaintCount, "mozPaintCount", code) // deprecated
rec(typeof onabsolutedeviceorientation, "onabsolutedeviceorientation", code)
rec(typeof onbeforeinput, "onbeforeinput", code)
rec(typeof ondevicelight, "ondevicelight", code) // deprecated
rec(typeof ondeviceproximity, "ondeviceproximity", code) // deprecated
rec(typeof ongamepadconnected, "ongamepadconnected", code)
rec(typeof ongamepaddisconnected, "ongamepaddisconnected", code)
rec(typeof onloadend, "onloadend", code)
rec(typeof onmozfullscreenchange, "onmozfullscreenchange", code)
rec(typeof onmozfullscreenerror, "onmozfullscreenerror", code)
rec(typeof onshow, "onshow", code) // deprecated
rec(typeof onuserproximity, "onuserproximity") // deprecated
rec(typeof onvrdisplayactivate, "onvrdisplayactivate", code) // pref (dom.vr.enabled)
rec(typeof onvrdisplayconnect, "onvrdisplayconnect", code) // pref
rec(typeof onvrdisplaydeactivate, "onvrdisplaydeactivate", code) // pref
rec(typeof onvrdisplaydisconnect, "onvrdisplaydisconnect", code) // pref
rec(typeof onvrdisplaypresentchange, "onvrdisplaypresentchange", code) // pref
rec(typeof scrollByLines, "scrollByLines", code)
rec(typeof scrollByPages, "scrollByPages", code)
rec(typeof scrollMaxX, "scrollMaxX", code)
rec(typeof scrollMaxY, "scrollMaxY", code)
rec(typeof setResizable, "setResizable", code)
rec(typeof sidebar, "sidebar", code) // deprecated
rec(typeof sizeToContent, "sizeToContent", code)
rec(typeof u2f, "u2f", code)
rec(typeof updateCommands, "updateCommands", code)

// webkit only
code = 14
rec(typeof browser, "browser", code)
rec(typeof getMatchedCSSRules, "getMatchedCSSRules", code)
rec(typeof safari, "safari", code)
rec(typeof showModalDialog, "showModalDialog", code)
rec(typeof webkitCancelRequestAnimationFrame, "webkitCancelRequestAnimationFrame", code)
rec(typeof webkitConvertPointFromNodeToPage, "webkitConvertPointFromNodeToPage", code)
rec(typeof webkitConvertPointFromPageToNode, "webkitConvertPointFromPageToNode", code)
rec(typeof webkitIndexedDB, "webkitIndexedDB", code)

// blink + gecko (not seen in webkit)
code = 50
rec(typeof KeyboardEvent, "KeyboardEvent", code)
rec(typeof KeyframeEffect, "KeyframeEffect", code)
rec(typeof cancelIdleCallback, "cancelIdleCallback", code)
rec(typeof external, "external", code)
rec(typeof onauxclick, "onauxclick", code)
rec(typeof ondevicemotion, "ondevicemotion", code)
rec(typeof ondeviceorientation, "ondeviceorientation", code)
rec(typeof ondragexit, "ondragexit", code) // touch
rec(typeof onmessageerror, "onmessageerror", code)
rec(typeof onorientationchange, "onorientationchange") // mobile/tablet
rec(typeof ontouchcancel, "ontouchcancel", code)
rec(typeof ontouchend, "ontouchend", code)
rec(typeof ontouchmove, "ontouchmove", code)
rec(typeof ontouchstart, "ontouchstart", code)
rec(typeof orientation, "orientation", code)
rec(typeof requestIdleCallback, "requestIdleCallback", code)
rec(typeof scheduler, "scheduler", code)

// blink + gecko (not seen in gecko)
code = 52
rec(typeof defaultstatus, "defaultstatus", code)
rec(typeof defaultStatus, "defaultStatus", code)
rec(typeof oncancel, "oncancel", code)
rec(typeof onmousewheel, "onmousewheel", code)
rec(typeof styleMedia, "styleMedia", code)
rec(typeof webkitCancelAnimationFrame, "webkitCancelAnimationFrame", code)
rec(typeof webkitRequestAnimationFrame, "webkitRequestAnimationFrame", code)

// gecko + webkit (not seen in blink)
code = 54
rec(typeof onanimationcancel, "onanimationcancel", code)

// I: IGNORE: confirmed common in blink, gecko, webkit
code = 99
rec(typeof addEventListener, "addEventListener", code)
rec(typeof alert, "alert", code)
rec(typeof applicationCache, "applicationCache", code)
	// ^ gecko confirmed: pref-to-be-deprecated (appCache itself is deprecated: the API does nothing)
	// ^ ignore: appCache would have been in other older engine(s) releases
rec(typeof atob, "atob", code)
rec(typeof blur, "blur", code)
rec(typeof btoa, "btoa", code)
rec(typeof caches, "caches", code)
rec(typeof cancelAnimationFrame, "cancelAnimationFrame", code)
rec(typeof captureEvents, "captureEvents", code)
rec(typeof clearInterval, "clearInterval", code)
rec(typeof clearTimeout, "clearTimeout", code)
rec(typeof clientInformation, "clientInformation", code)
rec(typeof close, "close", code)
rec(typeof closed, "closed", code)
rec(typeof confirm, "confirm", code)
rec(typeof createImageBitmap, "createImageBitmap", code)
rec(typeof crossOriginIsolated, "crossOriginIsolated", code)
rec(typeof crypto, "crypto", code)
rec(typeof customElements, "customElements", code)
rec(typeof devicePixelRatio, "devicePixelRatio", code)
rec(typeof dispatchEvent, "dispatchEvent", code)
rec(typeof document, "document", code)
rec(typeof fetch, "fetch", code)
rec(typeof find, "find", code)
rec(typeof focus, "focus", code)
rec(typeof frameElement, "frameElement", code)
rec(typeof frames, "frames", code)
rec(typeof getComputedStyle, "getComputedStyle", code)
rec(typeof getSelection, "getSelection", code)
rec(typeof history, "history", code)
rec(typeof indexedDB, "indexedDB", code)
rec(typeof innerHeight, "innerHeight", code)
rec(typeof innerWidth, "innerWidth", code)
rec(typeof isSecureContext, "isSecureContext", code)
rec(typeof length, "length", code)
rec(typeof localStorage, "localStorage", code)
rec(typeof location, "location", code)
rec(typeof locationbar, "locationbar", code)
rec(typeof matchMedia, "matchMedia", code)
rec(typeof menubar, "menubar", code)
rec(typeof moveBy, "moveBy", code)
rec(typeof moveTo, "moveTo", code)
rec(typeof name, "name", code)
rec(typeof navigator, "navigator", code)
rec(typeof onabort, "onabort", code)
rec(typeof onafterprint, "onafterprint", code)
rec(typeof onanimationend, "onanimationend", code)
rec(typeof onanimationiteration, "onanimationiteration", code)
rec(typeof onanimationstart, "onanimationstart", code)
rec(typeof onbeforeprint, "onbeforeprint", code)
rec(typeof onbeforeunload, "onbeforeunload", code)
rec(typeof onblur, "onblur", code)
rec(typeof oncanplay, "oncanplay", code)
rec(typeof oncanplaythrough, "oncanplaythrough", code)
rec(typeof onchange, "onchange", code)
rec(typeof onclick, "onclick", code)
rec(typeof onclose, "onclose", code)
rec(typeof oncontextmenu, "oncontextmenu", code)
rec(typeof oncuechange, "oncuechange", code)
rec(typeof ondblclick, "ondblclick", code)
rec(typeof ondrag, "ondrag", code)
rec(typeof ondragend, "ondragend", code)
rec(typeof ondragenter, "ondragenter", code)
rec(typeof ondragleave, "ondragleave", code)
rec(typeof ondragover, "ondragover", code)
rec(typeof ondragstart, "ondragstart", code)
rec(typeof ondrop, "ondrop", code)
rec(typeof ondurationchange, "ondurationchange", code)
rec(typeof onemptied, "onemptied", code)
rec(typeof onended, "onended", code)
rec(typeof onerror, "onerror", code)
rec(typeof onfocus, "onfocus", code)
rec(typeof onformdata, "onformdata", code)
rec(typeof ongotpointercapture, "ongotpointercapture", code)
rec(typeof onhashchange, "onhashchange", code)
rec(typeof oninput, "oninput", code)
rec(typeof oninvalid, "oninvalid", code)
rec(typeof onkeydown, "onkeydown", code)
rec(typeof onkeypress, "onkeypress", code)
rec(typeof onkeyup, "onkeyup", code)
rec(typeof onlanguagechange, "onlanguagechange", code)
rec(typeof onload, "onload", code)
rec(typeof onloadeddata, "onloadeddata", code)
rec(typeof onloadedmetadata, "onloadedmetadata", code)
rec(typeof onloadstart, "onloadstart", code)
rec(typeof onlostpointercapture, "onlostpointercapture", code)
rec(typeof onmessage, "onmessage", code)
rec(typeof onmousedown, "onmousedown", code)
rec(typeof onmouseenter, "onmouseenter", code)
rec(typeof onmouseleave, "onmouseleave", code)
rec(typeof onmousemove, "onmousemove", code)
rec(typeof onmouseout, "onmouseout", code)
rec(typeof onmouseover, "onmouseover", code)
rec(typeof onmouseup, "onmouseup", code)
rec(typeof onoffline, "onoffline", code)
rec(typeof ononline, "ononline", code)
rec(typeof onpagehide, "onpagehide", code)
rec(typeof onpageshow, "onpageshow", code)
rec(typeof onpause, "onpause", code)
rec(typeof onplay, "onplay", code)
rec(typeof onplaying, "onplaying", code)
rec(typeof onpointercancel, "onpointercancel", code)
rec(typeof onpointerdown, "onpointerdown", code)
rec(typeof onpointerenter, "onpointerenter", code)
rec(typeof onpointerleave, "onpointerleave", code)
rec(typeof onpointermove, "onpointermove", code)
rec(typeof onpointerout, "onpointerout", code)
rec(typeof onpointerover, "onpointerover", code)
rec(typeof onpointerup, "onpointerup", code)
rec(typeof onpopstate, "onpopstate", code)
rec(typeof onprogress, "onprogress", code)
rec(typeof onratechange, "onratechange", code)
rec(typeof onrejectionhandled, "onrejectionhandled", code)
rec(typeof onreset, "onreset", code)
rec(typeof onresize, "onresize", code)
rec(typeof onscroll, "onscroll", code)
rec(typeof onsecuritypolicyviolation, "onsecuritypolicyviolation", code)
rec(typeof onseeked, "onseeked", code)
rec(typeof onseeking, "onseeking", code)
rec(typeof onselect, "onselect", code)
rec(typeof onselectionchange, "onselectionchange", code)
rec(typeof onselectstart, "onselectstart", code)
rec(typeof onslotchange, "onslotchange", code)
rec(typeof onstalled, "onstalled", code)
rec(typeof onstorage, "onstorage", code)
rec(typeof onsubmit, "onsubmit", code)
rec(typeof onsuspend, "onsuspend", code)
rec(typeof ontimeupdate, "ontimeupdate", code)
rec(typeof ontoggle, "ontoggle", code)
rec(typeof ontransitioncancel, "ontransitioncancel", code)
rec(typeof ontransitionend, "ontransitionend", code)
rec(typeof ontransitionrun, "ontransitionrun", code)
rec(typeof ontransitionstart, "ontransitionstart", code)
rec(typeof onunhandledrejection, "onunhandledrejection", code)
rec(typeof onunload, "onunload", code)
rec(typeof onvolumechange, "onvolumechange", code)
rec(typeof onwaiting, "onwaiting", code)
rec(typeof onwebkitanimationend, "onwebkitanimationend", code)
rec(typeof onwebkitanimationiteration, "onwebkitanimationiteration", code)
rec(typeof onwebkitanimationstart, "onwebkitanimationstart", code)
rec(typeof onwebkittransitionend, "onwebkittransitionend", code)
rec(typeof onwheel, "onwheel", code)
rec(typeof open, "open", code)
rec(typeof opener, "opener", code)
rec(typeof origin, "origin", code)
rec(typeof outerHeight, "outerHeight", code)
rec(typeof outerWidth, "outerWidth", code)
rec(typeof pageXOffset, "pageXOffset", code)
rec(typeof pageYOffset, "pageYOffset", code)
rec(typeof parent, "parent", code)
rec(typeof performance, "performance", code)
rec(typeof personalbar, "personalbar", code)
rec(typeof postMessage, "postMessage", code)
rec(typeof print, "print", code)
rec(typeof prompt, "prompt", code)
rec(typeof queueMicrotask, "queueMicrotask", code)
rec(typeof releaseEvents, "releaseEvents", code)
rec(typeof removeEventListener, "removeEventListener", code)
rec(typeof reportError, "reportError", code)
rec(typeof requestAnimationFrame, "requestAnimationFrame", code)
rec(typeof resizeBy, "resizeBy", code)
rec(typeof resizeTo, "resizeTo", code)
rec(typeof screen, "screen", code)
rec(typeof screenLeft, "screenLeft", code)
rec(typeof screenTop, "screenTop", code)
rec(typeof screenX, "screenX", code)
rec(typeof screenY, "screenY", code)
rec(typeof scroll, "scroll", code)
rec(typeof scrollBy, "scrollBy", code)
rec(typeof scrollTo, "scrollTo", code)
rec(typeof scrollX, "scrollX", code)
rec(typeof scrollY, "scrollY", code)
rec(typeof scrollbars, "scrollbars", code)
rec(typeof self, "self", code)
rec(typeof sessionStorage, "sessionStorage", code)
rec(typeof setInterval, "setInterval", code)
rec(typeof setTimeout, "setTimeout", code)
rec(typeof speechSynthesis, "speechSynthesis", code)
rec(typeof status, "status", code)
rec(typeof statusbar, "statusbar", code)
rec(typeof stop, "stop", code)
rec(typeof structuredClone, "structuredClone", code)
rec(typeof toolbar, "toolbar", code)
rec(typeof top, "top", code)
rec(typeof visualViewport, "visualViewport", code)
rec(typeof window, "window", code)

// LEVEL 2
// I don't think we need bother with level 2 for a mini isEngine
/*
if ("undefined" !== typeof caches) {
	rec(typeof caches.delete, "caches.delete")
	rec(typeof caches.has, "caches.has")
	rec(typeof caches.keys, "caches.keys")
	rec(typeof caches.match, "caches.match")
	rec(typeof caches.open, "caches.open")
}
*/
		output()
	} catch(e) {
		console.error(e.name, e.message)
	}
}

function scrape() {
	domresult.innerHTML = "<br>... running"

	aNew = []
	// delay so user sees changes
	setTimeout(function() {
		tstart = performance.now()
		let result = collectProps().window

		// cleanup
		delete result.dom // just in case
		delete result.collectProps
		delete result.compare
		delete result.copyclip
		delete result.logConsole
		delete result.mini
		delete result.mini_sha1
		delete result.output
		delete result.rec
		delete result.rerun
		delete result.reset
		delete result.run
		delete result.scrape
		delete result.sha1
		//console.log(result)

		// hash it for easier compare
		let hash = mini_sha1(result)
		domperf.innerHTML = Math.round((performance.now() - tstart)) +" ms | "

		// check if any first level items are not in aList
		let strNew = ""
		if (aList.length) {
			aNew = Object.keys(result)
			aNew = aNew.filter(x => !aList.includes(x))
			if (aNew.length) {
				strNew = sb +"NEW:"+ sc + "<br><br>'" + aNew.join("', '") +"'"+ sc +"<br><br>"
			}
		}
		domresult.innerHTML = strNew + s3 + "HASH: "+ sc + hash +"<br><br>"
			+ JSON.stringify(result, null, 2)

	}, 100)
}

reset()
run()

function compare() {
	// examples: just paste in scrape results
	let sBlink = {"all3": [], "blink": [], "blink-gecko": [], "blink-webkit": []}
	let sGecko = {"all3": [], "gecko": [], "blink-gecko": [], "gecko-webkit": []}
	let sWebkit = {"all3": [], "webkit": [], "blink-webkit": [], "gecko-webkit": []}

	let aBlink = Object.keys(sBlink)
	let aGecko = Object.keys(sGecko)
	let aWebkit = Object.keys(sWebkit)

	let commonBG = aBlink.filter(x => aGecko.includes(x))
	let commonBW = aBlink.filter(x => aWebkit.includes(x))
	let commonGW = aGecko.filter(x => aWebkit.includes(x))
	let common = commonBG.concat(commonBW)
	common = common.concat(commonGW)
	common = common.filter(function(item, position) {return common.indexOf(item) === position})
	common.sort()
	console.log("NOT UNIQUE: "+ common.length +"\n" + common.join("\n"))

	let common3 = commonBG
	common3 = commonBG.filter(x => aWebkit.includes(x))
	common3 = common3.filter(function(item, position) {return common3.indexOf(item) === position})
	common3.sort()
	console.log("COMMON IN ALL THREE: "+ common3.length +"\n" + common3.join("\n"))

	let BGonly = commonBG.filter(x => !common3.includes(x))
	BGonly.sort()
	console.log("COMMON IN BLINK + GECKO ONLY: "+ BGonly.length +"\n" + BGonly.join("\n"))

	let BWonly = commonBW.filter(x => !common3.includes(x))
	BWonly.sort()
	console.log("COMMON IN BLINK + WEBKIT ONLY: "+ BWonly.length +"\n" + BWonly.join("\n"))

	let GWonly = commonGW.filter(x => !common3.includes(x))
	GWonly.sort()
	console.log("COMMON IN GECKO + WEBKIT ONLY: "+ GWonly.length +"\n" + GWonly.join("\n"))
}
//compare()

</script>
</body>
</html>
