<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=900">
	<title>engine properties</title>
	<link rel="stylesheet" type="text/css" href="testindex.css">
	<!--<script src="testglobals.js"></script>
	<script src="testgeneric.js"></script>-->
	<!-- custom -->
	<style>
		table {width: 880px;}
		#tb3 td:first-child { text-align: left; vertical-align: top;}
		hr {color: #dcc18c}
	</style>
</head>
<body>

	<table>
	<tr><td><h2>TorZillaPrint</h2></td></tr>
	<tr><td class="blurb"><a class="return" href="../index.html">return to TZP index</a></td></tr>
	</table>

	<table id="tb3">
		<col width="50%"><col width="50%">
		<thead><tr><th colspan="2">
			<div class="nav-title">engine properties
				<div class="nav-up"><span class="c perf" id="perf"></span></div>
			</div>
		</th></tr></thead>
		<tr><td colspan="2" class="mono" style="text-align: left; vertical-align: top;">
			<span class="btn3 btnfirst" onClick="rerun()">[ run ]</span>
			<span class="btn3 btn" onClick="logConsole(`list`)">[ log list ]</span>
			<span class="btn3 btn" onClick="scrape()">[ scrape ]</span>
			<span class="btn3 btn" onClick="copyclip(`results`)">[ copy ]</span>
			<br><br>
			<hr>
			<br>
			<span class="spaces" style="color: #b3b3b3;" id="results"></span>
			</td>
		</tr>
	</table>
	<br>

<script>
'use strict';

let oTypes = {},
	aList = [],
	aNew = [], // level 1 items found in scrape not in the test
	aErr = [], // invalid group codes
	tstart,
	domresult = document.getElementById("results"),
	domperf = document.getElementById("perf"),
	s3 = "<span class='s3'>",
	s9 = "<span class='s9'>",
	s14 = "<span class='s14'>",
	sb = "<span class='bad'>",
	sg = "<span class='good'>",
	sc = "</span>",
	green_tick = "<span style='font-size: 10px;'><b>" + s9 +" \u2713"+ sc + "</b></span>",
	red_cross = "<span style='font-size: 10px;'><b>" + sb +" \u2715"+ sc + "</b></span>"

/** functions from generic **/
// we don't want to include globals or generic which will pollute scraping

function mini(str) {
	// https://stackoverflow.com/a/22429679
	const json = `${JSON.stringify(str)}`
	let i, len, hash = 0x811c9dc5
	for (i = 0, len = json.length; i < len; i++) {
		hash = Math.imul(31, hash) + json.charCodeAt(i) | 0
	}
	return ('0000000' + (hash >>> 0).toString(16)).slice(-8)
}

function mini_sha1(str) {
	return sha1(mini(str))
}

function sha1(str1){
	for (var blockstart=0,
		i = 0,
		W = [],
		H = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0],
		A, B, C, D, F, G,
		word_array = [],
		temp2,
		s = unescape(encodeURI(str1)),
		str_len = s.length;
		i<=str_len;){
		word_array[i>>2] |= (s.charCodeAt(i)||128)<<(8*(3-i++%4));
	}
	word_array[temp2 = ((str_len+8)>>6<<4)+15] = str_len<<3;
	for (; blockstart <= temp2; blockstart += 16) {
		A = H,i=0;
		for (; i < 80;
			A = [[
				(G = ((s=A[0])<<5|s>>>27) + A[4] + (W[i] = (i<16) ? ~~word_array[blockstart + i] : G<<1|G>>>31) + 1518500249) + ((B=A[1]) & (C=A[2]) | ~B & (D=A[3])),
				F = G + (B ^ C ^ D) + 341275144,
				G + (B & C | B & D | C & D) + 882459459,
				F + 1535694389
			][0|i++/20] | 0, s, B<<30|B>>>2, C, D]
		) {
			G = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];
		}
		for(i=5;i;) H[--i] = H[i] + A[i] | 0;
	}
	for(str1='';i<40;)str1 += (H[i>>3] >> (7-i++%8)*4 & 15).toString(16);
	return str1
}

function copyclip(element) {
	// fallback: e.g FF62-
	function copyExec() {
		if (document.selection) {
			let range = document.body.createTextRange()
			range.moveToElementText(document.getElementById(element))
			range.select().createTextRange()
			document.execCommand("copy")
		} else if (window.getSelection) {
			let range = document.createRange()
			range.selectNode(document.getElementById(element))
			window.getSelection().addRange(range)
			document.execCommand("copy")
		}
	}
	// clipboard API
	if ("clipboard" in navigator) {
		try {
			let content = document.getElementById(element).innerHTML
			// remove spans, change linebreaks
			let regex = /<br\s*[\/]?>/gi
			content = content.replace(regex, "\r\n")
			content = content.replace(/<\/?span[^>]*>/g,"")
			content = content.replace(/<\/?hr[^>]*>/g,"")
			// get it
			navigator.clipboard.writeText(content).then(function() {
				// clipboard successfully set
			}, function() {
				// clipboard write failed
				copyExec()
			})
		} catch(e) {
			copyExec()
		}
	} else {
		copyExec()
	}
}

/** function for this test **/

function collectProps () {
    const objCache = new Set();
    // skip these
    objCache.add(window.self);
    // prevent us decending into the DOM
    objCache.add(document);
    objCache.add(document.activeElement);
    //objCache.add(event?.currentTarget); // FF73 or lower this causes a syntax error
		if (self.event && event.currentTarget) objCache.add(event.currentTarget)

    const recursionAllowed = new Set();
    recursionAllowed.add('navigator');

    function extractObjectProps (obj, breadcrumbs = [], depth = 0) {
        if (depth >= 5) {
            return {};
        }
        const props = {};
        const proplist = [];
        for (const prop in obj) {
            proplist.push(prop);
        }
        proplist.sort().forEach((prop) => {
            try {
                const desc = Object.getOwnPropertyDescriptor(obj, prop) || {};
                desc.type = typeof obj[prop];
                if (desc.type === 'function') {
                    desc.value = obj[prop].toString();
                } else if (desc.type === 'object') {
                    if (!objCache.has(obj[prop]) || recursionAllowed.has(prop)) {
                        objCache.add(obj[prop]);
                        desc.properties = extractObjectProps(obj[prop], [...breadcrumbs, prop], depth + 1);
                    }
                    delete desc.value;
                }
                props[prop] = desc;
            } catch (e) {
                console.warn(`Error for ${breadcrumbs.join('.')}.${prop}`, e);
            }
        });
        return props;
    }

    return {
        window: extractObjectProps(window)
    }
}

function logConsole(name) {
	let array = [], str = ""
	if (name == "list") { array = aList; str = "TEST LIST"
	}
	console.log(str +" [" + array.length +"]\n" + array.join("\n"))
}

function output() {

	aList.sort()
	domperf.innerHTML = Math.round((performance.now() - tstart)) +" ms | "+ aList.length +" items"
	// rename objects for sorting
		// leave spaces for edgeHTML and other groups
	oTypes[0] = oTypes["B"]; delete oTypes["B"]
	oTypes[2] = oTypes["G"]; delete oTypes["G"]
	oTypes[4] = oTypes["W"]; delete oTypes["W"]
	oTypes[6] = oTypes["N"]; delete oTypes["N"]
	oTypes[9] = oTypes["U"]; delete oTypes["U"]

	let display = []
	for (const k of Object.keys(oTypes).sort()) {
		let group = oTypes[k]
		let gHash = []
		let gDisplay = []
		let gCount = 0
		// get group details
		for (const n of Object.keys(group).sort()) {
			let data = group[n]
			data.sort()
			gCount += data.length
			if (data.length) {
				let tHash = mini_sha1(data.join())
				gHash.push(n +": "+ tHash)
				gDisplay.push(s3 + n.padStart(14) + sc +": "+ tHash + s3 +" ["+ data.length +"]"+ sc +"<br>")
				gDisplay.push("'"+ data.join("', '") + "'<br>")
			}
		}

		// get group hash
		let hashG = gHash.length ? mini_sha1(gHash.join()) +" ["+ gCount +"]" : ""
		// add group header
		let strG = ""
		if (k == 0) {strG = "BLINK ONLY"
		} else if (k == 2) { strG = "GECKO ONLY"
		} else if (k == 4) { strG = "WEBKIT ONLY"
		} else if (k == 6) { strG = "NOT UNIQUE"
		} else if (k == 9) { strG = "UNDETERMINED"
		}
		strG = strG.padStart(14)
		let header = strG + (gHash.length ? ": "+ hashG : "")
		display.push(s14 + header + sc +"<br>")

		// add group detail
		if (gHash.length) {
			display.push(gDisplay.join("<br>"))
		}
		// hr
		if (k < 9) {
			display.push("<br><hr>")
		}

	}
	// invalid group codes
	let strErr = ""
	if (aErr.length) {
		strErr = sb + "INVALID GROUP CODES" + sc
			+ "<br><br>" + aErr.join(", ") + "<br><br><hr><br>"
	}
	// function hash
	let strF = ""
	try {
		let testF = atob.toString()
		testF = testF.replace(/\n/g,'\\n');
		let hashF = mini(testF)
		strF = s14 + "FUNCTION: "+ sc + hashF + " : " + testF + "<br><br><hr><br>"

	} catch(e) {
		console.error(e.name, e.message)
	}

	domresult.innerHTML = strF + strErr + display.join("<br>")
}

function rec(type, name, group = "U") {
		group = group.toUpperCase() // in case of a typo
		aList.push(name)
		// ToDo: record a list per group

		try {
			oTypes[group][type].push(name)
		} catch(e) {
			aErr.push(name)
			oTypes["U"][type].push(name)
		}
}

function reset() {
	aList = []
	aErr = []
	domresult.innerHTML = ""
	oTypes = {}
	// B only_blink, G only gecko, W only webkit, M multiple engines U undetermined
	let groups = ["B","G","W","N","U"]
	let types = ["bigint","boolean","function","number","object","string","symbol","undefined",]
	groups.forEach(function(group) {
		oTypes[group] = {}
		types.forEach(function(type) {
			oTypes[group][type] = []
		})
	})
}

function rerun() {
	reset()
	// delay so user sees changes
	setTimeout(function() {
		run()
	}, 170)
}

function run() {
	try {
		tstart = performance.now()

// LEVEL ONE
rec(typeof addEventListener, "addEventListener", "N")
rec(typeof alert, "alert", "N")
rec(typeof applicationCache, "applicationCache")
rec(typeof atob, "atob", "N")
rec(typeof blur, "blur", "N")
rec(typeof browser, "browser", "W")
rec(typeof btoa, "btoa", "N")
rec(typeof caches, "caches", "N")
rec(typeof cancelAnimationFrame, "cancelAnimationFrame", "N")
rec(typeof cancelIdleCallback, "cancelIdleCallback", "N")
rec(typeof captureEvents, "captureEvents", "N")
rec(typeof chrome, "chrome", "B")
rec(typeof clearInterval, "clearInterval", "N")
rec(typeof clearTimeout, "clearTimeout", "N")
rec(typeof clientInformation, "clientInformation", "N")
rec(typeof close, "close", "N")
rec(typeof closed, "closed", "N")
rec(typeof confirm, "confirm", "N")
rec(typeof content, "content")
rec(typeof cookieStore, "cookieStore")
rec(typeof createImageBitmap, "createImageBitmap", "N")
rec(typeof crossOriginIsolated, "crossOriginIsolated", "N")
rec(typeof crypto, "crypto", "N")
rec(typeof customElements, "customElements", "N")
rec(typeof defaultstatus, "defaultstatus")
rec(typeof defaultStatus, "defaultStatus")
rec(typeof devicePixelRatio, "devicePixelRatio", "N")
rec(typeof dispatchEvent, "dispatchEvent", "N")
rec(typeof document, "document", "N")
rec(typeof dump, "dump")
rec(typeof event, "event")
rec(typeof external, "external", "N")
rec(typeof fetch, "fetch", "N")
rec(typeof find, "find", "N")
rec(typeof focus, "focus", "N")
rec(typeof frameElement, "frameElement", "N")
rec(typeof frames, "frames", "N")
rec(typeof fullScreen, "fullScreen")
rec(typeof getComputedStyle, "getComputedStyle", "N")
rec(typeof getDefaultComputedStyle, "getDefaultComputedStyle")
rec(typeof getDigitalGoodsService, "getDigitalGoodsService") // chrome-android
rec(typeof getMatchedCSSRules, "getMatchedCSSRules", "W")
rec(typeof getScreenDetails, "getScreenDetails")
rec(typeof getSelection, "getSelection", "N")
rec(typeof history, "history", "N")
rec(typeof indexedDB, "indexedDB", "N")
rec(typeof innerHeight, "innerHeight", "N")
rec(typeof innerWidth, "innerWidth", "N")
rec(typeof InstallTrigger, "InstallTrigger", "G")
rec(typeof isSecureContext, "isSecureContext", "N")
rec(typeof Keyboard, "Keyboard")
rec(typeof KeyboardEvent, "KeyboardEvent", "N")
rec(typeof KeyboardLayoutMap, "KeyboardLayoutMap")
rec(typeof KeyEvent, "KeyEvent", "G")
rec(typeof KeyframeEffect, "KeyframeEffect")
rec(typeof keys, "keys")
rec(typeof launchQueue, "launchQueue")
rec(typeof length, "length", "N")
rec(typeof localStorage, "localStorage", "N")
rec(typeof location, "location", "N")
rec(typeof locationbar, "locationbar", "N")
rec(typeof matchMedia, "matchMedia", "N")
rec(typeof menubar, "menubar", "N")
rec(typeof moveBy, "moveBy", "N")
rec(typeof moveTo, "moveTo", "N")
rec(typeof mozInnerScreenX, "mozInnerScreenX", "G")
rec(typeof mozInnerScreenY, "mozInnerScreenY", "G")
rec(typeof mozPaintCount, "mozPaintCount", "G")
rec(typeof name, "name", "N")
rec(typeof navigation, "navigation")
rec(typeof navigator, "navigator", "N")
rec(typeof offscreenBuffering, "offscreenBuffering", "N")
rec(typeof onabort, "onabort", "N")
rec(typeof onabsolutedeviceorientation, "onabsolutedeviceorientation")
rec(typeof onafterprint, "onafterprint", "N")
rec(typeof onanimationcancel, "onanimationcancel")
rec(typeof onanimationend, "onanimationend", "N")
rec(typeof onanimationiteration, "onanimationiteration", "N")
rec(typeof onanimationstart, "onanimationstart", "N")
rec(typeof onappinstalled, "onappinstalled")
rec(typeof onauxclick, "onauxclick", "N")
rec(typeof onbeforeinput, "onbeforeinput")
rec(typeof onbeforeinstallprompt, "onbeforeinstallprompt")
rec(typeof onbeforematch, "onbeforematch")
rec(typeof onbeforeprint, "onbeforeprint", "N")
rec(typeof onbeforeunload, "onbeforeunload", "N")
rec(typeof onbeforexrselect, "onbeforexrselect")
rec(typeof onblur, "onblur", "N")
rec(typeof oncancel, "oncancel")
rec(typeof oncanplay, "oncanplay", "N")
rec(typeof oncanplaythrough, "oncanplaythrough", "N")
rec(typeof onchange, "onchange", "N")
rec(typeof onclick, "onclick", "N")
rec(typeof onclose, "onclose", "N")
rec(typeof oncontextlost, "oncontextlost")
rec(typeof oncontextmenu, "oncontextmenu", "N")
rec(typeof oncontextrestored, "oncontextrestored")
rec(typeof oncuechange, "oncuechange", "N")
rec(typeof ondblclick, "ondblclick", "N")
rec(typeof ondevicelight, "ondevicelight")
rec(typeof ondevicemotion, "ondevicemotion", "N")
rec(typeof ondeviceorientation, "ondeviceorientation", "N")
rec(typeof ondeviceorientationabsolute, "ondeviceorientationabsolute")
rec(typeof ondeviceproximity, "ondeviceproximity")
rec(typeof ondrag, "ondrag", "N")
rec(typeof ondragend, "ondragend", "N")
rec(typeof ondragenter, "ondragenter", "N")
rec(typeof ondragexit, "ondragexit")
rec(typeof ondragleave, "ondragleave", "N")
rec(typeof ondragover, "ondragover", "N")
rec(typeof ondragstart, "ondragstart", "N")
rec(typeof ondrop, "ondrop", "N")
rec(typeof ondurationchange, "ondurationchange", "N")
rec(typeof onemptied, "onemptied", "N")
rec(typeof onended, "onended", "N")
rec(typeof onerror, "onerror", "N")
rec(typeof onfocus, "onfocus", "N")
rec(typeof onformdata, "onformdata", "N")
rec(typeof ongamepadconnected, "ongamepadconnected")
rec(typeof ongamepaddisconnected, "ongamepaddisconnected")
rec(typeof ongotpointercapture, "ongotpointercapture", "N")
rec(typeof onhashchange, "onhashchange", "N")
rec(typeof oninput, "oninput", "N")
rec(typeof oninvalid, "oninvalid", "N")
rec(typeof onkeydown, "onkeydown", "N")
rec(typeof onkeypress, "onkeypress", "N")
rec(typeof onkeyup, "onkeyup", "N")
rec(typeof onlanguagechange, "onlanguagechange", "N")
rec(typeof onload, "onload", "N")
rec(typeof onloadeddata, "onloadeddata", "N")
rec(typeof onloadedmetadata, "onloadedmetadata", "N")
rec(typeof onloadend, "onloadend")
rec(typeof onloadstart, "onloadstart", "N")
rec(typeof onlostpointercapture, "onlostpointercapture", "N")
rec(typeof onmessage, "onmessage", "N")
rec(typeof onmessageerror, "onmessageerror", "N")
rec(typeof onmousedown, "onmousedown", "N")
rec(typeof onmouseenter, "onmouseenter", "N")
rec(typeof onmouseleave, "onmouseleave", "N")
rec(typeof onmousemove, "onmousemove", "N")
rec(typeof onmouseout, "onmouseout", "N")
rec(typeof onmouseover, "onmouseover", "N")
rec(typeof onmouseup, "onmouseup", "N")
rec(typeof onmousewheel, "onmousewheel")
rec(typeof onmozfullscreenchange, "onmozfullscreenchange", "G")
rec(typeof onmozfullscreenerror, "onmozfullscreenerror", "G")
rec(typeof onoffline, "onoffline", "N")
rec(typeof ononline, "ononline", "N")
rec(typeof onorientationchange, "onorientationchange")
rec(typeof onpagehide, "onpagehide", "N")
rec(typeof onpageshow, "onpageshow", "N")
rec(typeof onpause, "onpause", "N")
rec(typeof onplay, "onplay", "N")
rec(typeof onplaying, "onplaying", "N")
rec(typeof onpointercancel, "onpointercancel", "N")
rec(typeof onpointerdown, "onpointerdown", "N")
rec(typeof onpointerenter, "onpointerenter", "N")
rec(typeof onpointerleave, "onpointerleave", "N")
rec(typeof onpointermove, "onpointermove", "N")
rec(typeof onpointerout, "onpointerout", "N")
rec(typeof onpointerover, "onpointerover", "N")
rec(typeof onpointerrawupdate, "onpointerrawupdate")
rec(typeof onpointerup, "onpointerup", "N")
rec(typeof onpopstate, "onpopstate", "N")
rec(typeof onprogress, "onprogress", "N")
rec(typeof onratechange, "onratechange", "N")
rec(typeof onrejectionhandled, "onrejectionhandled", "N")
rec(typeof onreset, "onreset", "N")
rec(typeof onresize, "onresize", "N")
rec(typeof onscroll, "onscroll", "N")
rec(typeof onsearch, "onsearch")
rec(typeof onsecuritypolicyviolation, "onsecuritypolicyviolation", "N")
rec(typeof onseeked, "onseeked", "N")
rec(typeof onseeking, "onseeking", "N")
rec(typeof onselect, "onselect", "N")
rec(typeof onselectionchange, "onselectionchange", "N")
rec(typeof onselectstart, "onselectstart")
rec(typeof onshow, "onshow")
rec(typeof onslotchange, "onslotchange")
rec(typeof onstalled, "onstalled", "N")
rec(typeof onstorage, "onstorage", "N")
rec(typeof onsubmit, "onsubmit", "N")
rec(typeof onsuspend, "onsuspend", "N")
rec(typeof ontimeupdate, "ontimeupdate", "N")
rec(typeof ontoggle, "ontoggle", "N")
rec(typeof ontouchcancel, "ontouchcancel")
rec(typeof ontouchend, "ontouchend")
rec(typeof ontouchmove, "ontouchmove")
rec(typeof ontouchstart, "ontouchstart")
rec(typeof ontransitioncancel, "ontransitioncancel", "N")
rec(typeof ontransitionend, "ontransitionend", "N")
rec(typeof ontransitionrun, "ontransitionrun", "N")
rec(typeof ontransitionstart, "ontransitionstart", "N")
rec(typeof onunhandledrejection, "onunhandledrejection", "N")
rec(typeof onunload, "onunload", "N")
rec(typeof onuserproximity, "onuserproximity")
rec(typeof onvolumechange, "onvolumechange", "N")
rec(typeof onvrdisplayactivate, "onvrdisplayactivate")
rec(typeof onvrdisplayconnect, "onvrdisplayconnect")
rec(typeof onvrdisplaydeactivate, "onvrdisplaydeactivate")
rec(typeof onvrdisplaydisconnect, "onvrdisplaydisconnect")
rec(typeof onvrdisplaypresentchange, "onvrdisplaypresentchange")
rec(typeof onwaiting, "onwaiting", "N")
rec(typeof onwebkitanimationend, "onwebkitanimationend", "N")
rec(typeof onwebkitanimationiteration, "onwebkitanimationiteration", "N")
rec(typeof onwebkitanimationstart, "onwebkitanimationstart", "N")
rec(typeof onwebkittransitionend, "onwebkittransitionend", "N")
rec(typeof onwheel, "onwheel", "N")
rec(typeof open, "open", "N")
rec(typeof openDatabase, "openDatabase")
rec(typeof opener, "opener", "N")
rec(typeof opr, "opr")
rec(typeof orientation, "orientation")
rec(typeof origin, "origin", "N")
rec(typeof originAgentCluster, "originAgentCluster")
rec(typeof outerHeight, "outerHeight", "N")
rec(typeof outerWidth, "outerWidth", "N")
rec(typeof pageXOffset, "pageXOffset", "N")
rec(typeof pageYOffset, "pageYOffset", "N")
rec(typeof parent, "parent", "N")
rec(typeof performance, "performance", "N")
rec(typeof PERSISTENT, "PERSISTENT", "B")
rec(typeof personalbar, "personalbar", "N")
rec(typeof postMessage, "postMessage", "N")
rec(typeof print, "print", "N")
rec(typeof prompt, "prompt", "N")
rec(typeof queryLocalFonts, "queryLocalFonts")
rec(typeof queueMicrotask, "queueMicrotask", "N")
rec(typeof releaseEvents, "releaseEvents", "N")
rec(typeof removeEventListener, "removeEventListener", "N")
rec(typeof reportError, "reportError", "N")
rec(typeof requestAnimationFrame, "requestAnimationFrame", "N")
rec(typeof requestIdleCallback, "requestIdleCallback", "N")
rec(typeof resizeBy, "resizeBy", "N")
rec(typeof resizeTo, "resizeTo", "N")
rec(typeof safari, "safari", "W")
rec(typeof scheduler, "scheduler", "N")
rec(typeof screen, "screen", "N")
rec(typeof screenLeft, "screenLeft", "N")
rec(typeof screenTop, "screenTop", "N")
rec(typeof screenX, "screenX", "N")
rec(typeof screenY, "screenY", "N")
rec(typeof scroll, "scroll", "N")
rec(typeof scrollBy, "scrollBy", "N")
rec(typeof scrollByLines, "scrollByLines")
rec(typeof scrollByPages, "scrollByPages")
rec(typeof scrollbars, "scrollbars", "N")
rec(typeof scrollMaxX, "scrollMaxX")
rec(typeof scrollMaxY, "scrollMaxY")
rec(typeof scrollTo, "scrollTo", "N")
rec(typeof scrollX, "scrollX", "N")
rec(typeof scrollY, "scrollY", "N")
rec(typeof self, "self", "N")
rec(typeof sessionStorage, "sessionStorage", "N")
rec(typeof setInterval, "setInterval", "N")
rec(typeof setResizable, "setResizable")
rec(typeof setTimeout, "setTimeout", "N")
rec(typeof showDirectoryPicker, "showDirectoryPicker")
rec(typeof showModalDialog, "showModalDialog", "W")
rec(typeof showOpenFilePicker, "showOpenFilePicker")
rec(typeof showSaveFilePicker, "showSaveFilePicker")
rec(typeof sidebar, "sidebar") // FF deprecated?
rec(typeof sizeToContent, "sizeToContent")
rec(typeof speechSynthesis, "speechSynthesis", "N")
rec(typeof status, "status", "N")
rec(typeof statusbar, "statusbar", "N")
rec(typeof stop, "stop", "N")
rec(typeof structuredClone, "structuredClone", "N")
rec(typeof styleMedia, "styleMedia")
rec(typeof TEMPORARY, "TEMPORARY", "B")
rec(typeof toolbar, "toolbar", "N")
rec(typeof top, "top", "N")
rec(typeof trustedTypes, "trustedTypes")
rec(typeof u2f, "u2f")
rec(typeof updateCommands, "updateCommands")
rec(typeof visualViewport, "visualViewport", "N")
rec(typeof webkitCancelAnimationFrame, "webkitCancelAnimationFrame")
rec(typeof webkitCancelRequestAnimationFrame, "webkitCancelRequestAnimationFrame", "W")
rec(typeof webkitConvertPointFromNodeToPage, "webkitConvertPointFromNodeToPage", "W")
rec(typeof webkitConvertPointFromPageToNode, "webkitConvertPointFromPageToNode", "W")
rec(typeof webkitIndexedDB, "webkitIndexedDB", "W")
rec(typeof webkitRequestAnimationFrame, "webkitRequestAnimationFrame")
rec(typeof webkitRequestFileSystem, "webkitRequestFileSystem")
rec(typeof webkitResolveLocalFileSystemURL, "webkitResolveLocalFileSystemURL")
rec(typeof webkitStorageInfo, "webkitStorageInfo")
rec(typeof window, "window", "N")

// LEVEL 2
let obj2 = "", str2 = ""
if ("undefined" !== typeof applicationCache) { // maybe drop this: it's being deprecated
	obj2 = applicationCache
	str2 = "applicationCache."
	rec(typeof obj2.CHECKING, str2+"CHECKING")
	rec(typeof obj2.DOWNLOADING, str2+"DOWNLOADING")
	rec(typeof obj2.IDLE, str2+"IDLE")
	rec(typeof obj2.OBSOLETE, str2+"OBSOLETE")
	rec(typeof obj2.UNCACHED, str2+"UNCACHED")
	rec(typeof obj2.UPDATEREADY, str2+"UPDATEREADY")
	rec(typeof obj2.addEventListener, str2+"addEventListener")
	rec(typeof obj2.dispatchEvent, str2+"dispatchEvent")
	rec(typeof obj2.length, str2+"length")
	rec(typeof obj2.mozAdd, str2+"mozAdd", "G")
	rec(typeof obj2.mozHasItem, str2+"mozHasItem", "G")
	rec(typeof obj2.mozItem, str2+"mozItem", "G")
	rec(typeof obj2.mozRemove, str2+"mozRemove", "G")
	rec(typeof obj2.oncached, str2+"oncached")
	rec(typeof obj2.onchecking, str2+"onchecking")
	rec(typeof obj2.ondownloading, str2+"ondownloading")
	rec(typeof obj2.onerror, str2+"onerror")
	rec(typeof obj2.onnoupdate, str2+"onnoupdate")
	rec(typeof obj2.onobsolete, str2+"onobsolete")
	rec(typeof obj2.onprogress, str2+"onprogress")
	rec(typeof obj2.onupdateready, str2+"onupdateready")
	rec(typeof obj2.removeEventListener, str2+"removeEventListener")
	rec(typeof obj2.status, str2+"status")
	rec(typeof obj2.swapCache, str2+"swapCache")
	rec(typeof obj2.update, str2+"update")
}
if ("undefined" !== typeof caches) {
	rec(typeof caches.delete, "caches.delete", "N")
	rec(typeof caches.has, "caches.has", "N")
	rec(typeof caches.keys, "caches.keys", "N")
	rec(typeof caches.match, "caches.match", "N")
	rec(typeof caches.open, "caches.open", "N")
}
		output()
	} catch(e) {
		console.error(e.name, e.message)
	}
}

function scrape() {
	domresult.innerHTML = "<br>... running"

	aNew = []
	// delay so user sees changes
	setTimeout(function() {
		tstart = performance.now()
		let result = collectProps().window

		// cleanup
		delete result.dom // just in case
		delete result.collectProps
		delete result.copyclip
		delete result.logConsole
		delete result.mini
		delete result.mini_sha1
		delete result.output
		delete result.rec
		delete result.rerun
		delete result.reset
		delete result.run
		delete result.scrape
		delete result.sha1
		//console.log(result)

		// hash it for easier compare
		let hash = mini_sha1(result)
		domperf.innerHTML = Math.round((performance.now() - tstart)) +" ms | "

		// check if any first level items are not in aList
		let strNew = ""
		if (aList.length) {
			aNew = Object.keys(result)
			aNew = aNew.filter(x => !aList.includes(x))
			if (aNew.length) {
				strNew = sb +"NEW:"+ sc + "<br><br>'" + aNew.join("', '") +"'"+ sc +"<br><br>"
			}
		}
		domresult.innerHTML = strNew + s3 + "HASH: "+ sc + hash +"<br><br>"
			+ JSON.stringify(result, null, 2)


	}, 100)
}

reset()
run()

</script>
</body>
</html>
